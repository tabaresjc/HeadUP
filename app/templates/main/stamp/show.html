{% extends "main/layout/base.html" %}
{% set title = post.title %}
{% set description = post.extra_body | striptags | limit(300) %}

{% block meta_extra %}
	<link rel="canonical" href="{{ url_for('stamp.show', id=post.id, _external=true) | replace_host_name }}">
	{% if config.FB_APPID %}
	<meta property="fb:app_id" content="{{ config.FB_APPID }}" />
	{% endif %}
	<meta property="og:type" content="article" />
	<meta property="og:url" content="{{ url_for('stamp.show', id=post.id, _external=true) | replace_host_name }}" />
	<meta property="og:title" content="{{ title }}" />
	<meta property="og:description" content="{{ description }}">
	{% if post.cover_picture %}
	<meta property="og:image" content="{{ url_for('pictures', name=post.cover_picture.name, _external=true) }}" />
	{% else %}
	<meta property="og:image" content="{{ url_for('static', filename='assets/headsup/images/lp-home/screen-bg_1.jpg', _external=true) }}" />
	{% endif %}
{% endblock %}

{% block content %}
<div class="boxed push-down-30">
	{% if post.cover_picture %}
	<div class="meta push-down-20">
		<div class="main-post-image" style="background-image:url({{ post.cover_picture.image_url }})"></div>
		<div class="meta__container">
			<div class="row">
				<div class="col-xs-12  col-sm-12">
					<div class="meta__info">
						<span class="meta__author">
						  {% if not post.anonymous -%}
						  <img src="{{ post.user.profile_picture_url or '/static/images/user.png' }}" alt="{{ post.user.name }}" width="30" height="30">
						  {% set user_name = '<a href="%s">%s</a>' % (url_for('stamp.show', id=post.id), post.user.name) %}
						  {%- else %}
						  <img src="/static/images/user.png" width="30" height="30"/>
						  {% set user_name = _('Anonymous') %}
						  {%- endif %}
						  {{ _('Posted by %(user)s', user=user_name|safe) }}
						  {% set category_name = '<a href="%s">%s</a>' % ('javascript:;', post.category.name) %}
						  {{ _('in %(category)s', category=category_name|safe) }}
						</span>
						<span class="meta__date"><span class="glyphicon glyphicon-calendar"></span> &nbsp; {{ post.created_at|datetimeformat('EEE, d MMM yyyy') }}</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% else %}
	<div class="meta push-down-20">
		<div class="row">
			<div class="col-xs-12  col-sm-10  col-sm-offset-1  col-md-10  col-md-offset-1">
				<div class="meta__container--without-image">
					<div class="row">
						<div class="col-xs-12  col-sm-12">
							<div class="meta__info">
								<span class="meta__author">
									<img src="{{ post.user.profile_picture_url or '/static/images/user.png' }}" alt="Meta avatar" width="30" height="30">
									<a href="javascript:void(0);">{{ post.user.name }}</a>  in <a href="javascript:void(0);">{{ post.category.name }}</a>
								</span>
								<span class="meta__date">
									<span class="glyphicon glyphicon-calendar"></span> &nbsp; {{ post.created_at|datetimeformat('EEE, d MMM yyyy') }}
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
	<div class="row">
		<div class="col-xs-10  col-xs-offset-1  col-md-10  col-md-offset-1  push-down-30">
			<div class="post-content">
				<h1 class="title">
					<a href="{{ url_for('stamp.show', id=post.id) }}">{{ post.title }}</a>
				</h1>
				<h3>{{ post.body|safe }}</h3>
				{% if post.editor_version %}
					{{ post.extra_body|safe }}
				{% else %}
					{{ post.extra_body|nl2br|safe }}
				{% endif %}
			</div>
		</div>
	</div>
	{% include 'main/stamp/partials/_counter.html' %}
</div>
{% endblock %}

{% block sidebar %}
	{% include 'main/common/_sidebar_user.html' %}
{% endblock %}


{% block custom_js %}
	{% if config.ADDTHIS_LINK_STAMP %}
	<script type="text/javascript" src="{{ config.ADDTHIS_LINK_STAMP }}"></script>
	{% endif %}
{% endblock %}
